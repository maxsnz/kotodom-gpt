generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
}

model TgUser {
  id    BigInt     @id
  username  String?
  name String?
  fullName  String?
  chats Chat[]
  createdAt DateTime @default(now())
  messages Message[]
}

model Message {
  id    Int     @id @default(autoincrement())
  chat Chat? @relation(fields: [chatId], references: [id], onDelete: Cascade)
  chatId String?
  tgUser TgUser? @relation(fields: [tgUserId], references: [id])
  tgUserId BigInt?
  bot Bot? @relation(fields: [botId], references: [id])
  botId   Int?
  text String
  price Decimal @default(0) @db.Decimal(10, 4)
  createdAt DateTime @default(now())
}

model Setting {
  id String @id
  value String?
}

enum TelegramModeEnum {
  polling
  webhook
}

model Bot {
  id    Int     @id @default(autoincrement())
  startMessage String
  errorMessage String @default("")
  name  String
  token String
  model String @default("gpt-4o-mini")
  createdAt DateTime @default(now())
  isActive Boolean @default(false)
  enabled Boolean @default(false)
  messages Message[]
  assistantId String
  error String?
  chats Chat[]
  telegramMode TelegramModeEnum @default(webhook)
}

model Chat {
  id    String     @id
  botId Int?
  bot Bot? @relation(fields: [botId], references: [id])
  threadId String?
  messages Message[]
  createdAt DateTime @default(now())
  tgUser    TgUser    @relation(fields: [tgUserId], references: [id])
  tgUserId  BigInt
  name String?
}